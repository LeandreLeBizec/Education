#le modèle sous estime le poid des vrèmes communes
# Question 5d : Graphes des résidus du second modèle
plot(reg2$fitted.values,reg2$residuals, ylim = c(-2,2), xlab="residus",ylab="valeur ajusté")
abline(h=0, col="blue")
abline(h=-2*resume2$sigma, col="red")
abline(h=2*resume2$sigma, col="red")
# Les hypothèses ne sont pas vérifiées, les valeurs ne sont répartis de manière homogène autour de l'axe x=0 et il n'y a pas homoscédasticité des valeurs
# strucuture parabolique
# Question 6a : Nuage de points du logarithme du poids en fonction de la longueur
plot(fish2$Length, fish2$Weight)
lines(Length, predict(reg2), col="blue",lwd=3)
# Question 6b : Proposition et ajustement d'un troisième modèle
# On observe une courbe parabolique sur le graphe des residus de la question 6a, il faut donc ajouter une variaves explicative au modèle
# On ajoute la variable explicative Length²
fish3 <- cbind.data.frame(fish2,Length2=fish2[,"Length"]^2)
reg3=lm(fish3$Weight~Length2, data=fish3)
resume3=summary(reg3)
resume3
plot(fish3$Length2, fish3$Weight)
lines(fish3$Length2, predict(reg3),col="green",lwd=3)
# Question 6c : Tracé de la courbe d'ajustement du troisième modèle
plot(Length, Weight, col=c(2,3,4,5,6,7,8)[fish$Species])
lines(Length, predict(reg),col="red",lwd=3)
lines(Length, exp(predict(reg2)), col="blue",lwd=3)
lines(Length, exp(predict(reg3)), col="green", lwd=3)
# Question 7 : Ajustement d'un modèle exponentiel
# Question 8a: Détermination du R^2 de l'AIC des modèles
# Question 8b : Prédiction du poids d'un poisson
########## EXERCICE 2 : AMERTUME ET COMPOSITION MINERALE DES POMMES ##########
# Question 1 : Lecture du fichier
# Question 2 : Analyse descriptive par traitement
# Question 3a : Régression linéaire multiple
# Question 3b : Intervalle de confiance sur un paramètre
# Question 3c
# Question 3d : Corrélation entre les variables explicatives
# Question 3e : Sélection de variables
# Question 3f
# Question 4a : ANOVA sur l'amertume des pommes
# Question 4b : Instructions pour estimer les paramètres du modèle
# Question 4c
# Question 5a
# Question 5b
# Question 5c
# Question 6
# Question 7
View(fish2)
fish[Species]
fish["Species"]
fish["Species"=1]
fish["Species"="1"]
fish["Species"]
fish["Species",]
fish[,"Species"]
fish[,"Species"=1]
fish[,"Species"="1"]
fish[,"Species"]
fish[,"Species"][1]
fish[,"Species"]["1"]
fish[,"Species"<1]
fish[,"Species"]
reg4=lm(log(Weight)~log(Length)+log(Height)+log(Width),data=fish)
resume4=summary(reg4)
resume
resume4
resume4$r.squared
R2 <- c(resume2$r.squared, resume3$r.squared, resume4$r.squared)
R2
#meilleur modèle : modèle3
C <- c(extractAIC(reg2), extractAIC(reg3), extractAIC(reg4))
C
extractAIC(reg2)
setwd("~/Info_3a/TP_R/TP_S6/TP3/TP3_Donnees")
#Q1
lait <- read.table("lait.txt", header = T)
attach(lait)
#Q2
cor(lait[,1:5])
#ExSec~Densite 0.76, TxCase~TxProt très corrélé 0.96
#redondance d'information... un modèle avec moins de variable peut aussi bien marcher
#Q3
plot(Densite, Rendement)
#semble pas linéaire
plot(TxButy, Rendement)
#semble linéaire
plot(TxProt, Rendement)
#semble linéaire
plot(TxCase, Rendement)
#semble linéaire
plot(ExSec, Rendement)
#semble linéaire
#Q4
reg=lm(Rendement~Densite+TxButy+TxProt+TxCase+ExSec, data=lait)
summary(reg)
#TxButy, ExSec pvalue<0.05 donc les seules qui ont un effet significatif
5*reg$coefficient[3] + 5*reg$coefficient[4] - 2*reg$coefficient[5]
#graphe des résidus
x <- TV
plot(reg$fitted.values,reg$residuals, ylim=c(-1,1), xlab="valeur ajusté",ylab="residus")
abline(h=0, col="blue")
abline(h=-2*resume$sigma, col="red")
abline(h=2*resume$sigma, col="red")
plot(reg, which=1)
plot(reg, which=2)
#par(mfrow=c(2,2))
#plot(reg)
#plutôt pas mal
#Q5
reg2=step(reg, direction="backward")
#calcul l'AIC, enleve une variable à chauqe tour et recalcul l'AIC puis le compare
#obj -> trouver l'AIC le plus petit
#backward : commence au nbr max de variable plus enleve
#forward : commence à une variable puis ajoute
#s'arrête quand il ne trouve pas de plus petit
#modele conservé : Densite + TxButy + TxProt + ExSec
#Q6
reg3=lm(Rendement ~ -1+Densite+TxButy+TxProt+ExSec, data=lait)
#enlève l'ordonnée à l'origine -> forcer à passer par 0
#Q7
extractAIC(reg)
extractAIC(reg2)
extractAIC(reg3)
summary(reg)$adj.r.squared
summary(reg2)$adj.r.squared
summary(reg3)$adj.r.squared
#on garde le modèle 3 car R2 plus intéressant même si AIC > reg2
#Q8
df = data.frame(rbind(c(Densite=1.032,TxButy=39.7,TxProt=31.9,ExSec=130),c(Densite=1.032,TxButy=42.8,TxProt=34.5,ExSec=130)))
predict(reg3, newdata = df, interval = "prediction")
#La meilleure vache est la Normande
#Q7
extractAIC(reg)
extractAIC(reg2)
extractAIC(reg3)
setwd("~/Info_3a/TP_R/TP_S6/TP_2021")
###########################################################
############ TP noté de Statistiques 2020-2021 ############
###########################################################
########## EXERCICE 1 : PREDICTION DU POIDS DES POISSONS ##########
# Question 1 : Lecture du fichier
fish <- read.csv2("Poissons.csv")
attach(fish)
# Question 2 : Transformation d'une variable en facteur
fish$Species=as.factor(fish$Species)
# Question 3 : Représentation du nuage de points du poids en fonction de la longueur
# on veut expliquer le poids grâce à la longueure du poisson
# variable à expliquer : Weight (y)
# variable explicative : Length (x)
plot(Length, Weight, col=c(2,3,4,5,6,7,8)[Species])
# Question 4a : Régression linéaire simple du poids sur la longueur
#reg(y~x, data)
reg=lm(Weight~Length, data=fish)
resume=summary(reg)
resume
# La taille du posson à une influence sur son poid : Proba critique < 0.05
# Question 4b : Droite de régression
lines(Length, predict(reg),col="red",lwd=3)
# Question 4c : Prédiction du poids d'un poisson de longueur 13 cm et de longueur 47 cm
predict(reg, data.frame(Length=13)) # impossible -> il faut revoir le modèle
predict(reg, data.frame(Length=47)) # prédiction plausible
# Question 4d : Graphe des résidus du premier modèle
plot(reg$fitted.values,reg$residuals, ylim = c(-500,500), xlab="residus",ylab="valeur ajusté")
abline(h=0, col="blue")
abline(h=-2*resume$sigma, col="red")
abline(h=2*resume$sigma, col="red")
# Les hypothèses ne sont pas vérifiées, les valeurs ne sont répartis de manière homogène autour de l'axe x=0 et il n'y a pas homoscédasticité des valeurs
# structure parabolique ?
# Question 5a : Régression linéaire simple du logarithme du poids sur la longueur
fish2 <- fish
fish2$Weight <- log(fish2$Weight)
reg2=lm(fish2$Weight~fish2$Length, data=fish2)
resume2=summary(reg2)
resume2
# Question 5b : Estimation de l'écart-type résiduel
x <- Length
y <- predict(reg2) #valeurs ajustées
e <- fish2$Weight - y # residu
sigma <- sqrt(sum(e^2)/(length(e)-2))
# On retrouve bien la même qu'avec summary
# Question 5c : Courbe d'ajustement du second modèle
plot(Length, Weight)
lines(Length, predict(reg),col="red",lwd=3)
lines(Length, exp(predict(reg2)), col="blue",lwd=3)
#le modèle sous estime le poid des vrèmes communes
# Question 5d : Graphes des résidus du second modèle
plot(reg2$fitted.values,reg2$residuals, ylim = c(-2,2), xlab="residus",ylab="valeur ajusté")
abline(h=0, col="blue")
abline(h=-2*resume2$sigma, col="red")
abline(h=2*resume2$sigma, col="red")
# Les hypothèses ne sont pas vérifiées, les valeurs ne sont répartis de manière homogène autour de l'axe x=0 et il n'y a pas homoscédasticité des valeurs
# strucuture parabolique
# Question 6a : Nuage de points du logarithme du poids en fonction de la longueur
plot(fish2$Length, fish2$Weight)
lines(Length, predict(reg2), col="blue",lwd=3)
# Question 6b : Proposition et ajustement d'un troisième modèle
# On observe une courbe parabolique sur le graphe des residus de la question 6a, il faut donc ajouter une variaves explicative au modèle
# On ajoute la variable explicative Length²
fish3 <- cbind.data.frame(fish2,Length2=fish2[,"Length"]^2)
reg3=lm(fish3$Weight~Length2, data=fish3)
resume3=summary(reg3)
resume3
plot(fish3$Length2, fish3$Weight)
lines(fish3$Length2, predict(reg3),col="green",lwd=3)
# Question 6c : Tracé de la courbe d'ajustement du troisième modèle
plot(Length, Weight, col=c(2,3,4,5,6,7,8)[fish$Species])
lines(Length, predict(reg),col="red",lwd=3)
lines(Length, exp(predict(reg2)), col="blue",lwd=3)
lines(Length, exp(predict(reg3)), col="green", lwd=3)
# pb avec les exponnentielles
# Question 7 : Ajustement d'un modèle exponentiel
reg4=lm(log(Weight)~log(Length)+log(Height)+log(Width),data=fish)
resume4=summary(reg4)
resume4
#a0 = -9.14250, a1 = 3.01707, a2 = 0.44477, a3 = 1.11300
# Question 8a: Détermination du R^2 de l'AIC des modèles
R2 <- c(resume2$r.squared, resume3$r.squared, resume4$r.squared)
# R² le plus proche de 1
# meilleur modèle : modèle3
C <- c(extractAIC(reg2), extractAIC(reg3), extractAIC(reg4))
# AIC le plus faible
#
# Question 8b : Prédiction du poids d'un poisson
########## EXERCICE 2 : AMERTUME ET COMPOSITION MINERALE DES POMMES ##########
# Question 1 : Lecture du fichier
# Question 2 : Analyse descriptive par traitement
# Question 3a : Régression linéaire multiple
# Question 3b : Intervalle de confiance sur un paramètre
# Question 3c
# Question 3d : Corrélation entre les variables explicatives
# Question 3e : Sélection de variables
# Question 3f
# Question 4a : ANOVA sur l'amertume des pommes
# Question 4b : Instructions pour estimer les paramètres du modèle
# Question 4c
# Question 5a
# Question 5b
# Question 5c
# Question 6
# Question 7
C
predict(reg4, data.frame(Length=c(13,47),Height=c(13*0.17,47*0.17),Width=c(0.1*13,0.1*47)),interval="prediction")
preidction = predict(reg4, data.frame(Length=c(13,47),Height=c(13*0.17,47*0.17),Width=c(0.1*13,0.1*47)),interval="prediction")
exp(prediction)
prediction = predict(reg4, data.frame(Length=c(13,47),Height=c(13*0.17,47*0.17),Width=c(0.1*13,0.1*47)),interval="prediction")
exp(prediction)
predict(reg4, data.frame(Length=c(13,47),Height=c(13*0.17,47*0.17),Width=c(0.1*13,0.1*47)),interval="prediction")
pommes <- read.table("pommes.txt", header = T)
pommes <- read.table("pommes.txt", header = T)
detach(fish)
detach(fish)
detach(fish)
detach(fish)
detach(fish)
detach(fish)
detach(fish)
detach(fish)
detach(fish)
detach(fish)
detach(fish)
detach(fish)
detach(fish)
detach(fish)
pommes <- read.table("pommes.txt", header = T)
View(pommes)
View(pommes)
attach(pommes)
reg=lm(Amert~TN+PN+P9K+CA+Mg, data=pommes)
reg=lm(Amert~TN+PN+PK+CA+Mg, data=pommes)
resume=summary(reg)
reg=lm(Amert~TN+PN+P+K+CA+Mg, data=pommes)
reg=lm(Amert~TN+PN+P+K+Ca+Mg, data=pommes)
resume=summary(reg)
resume
resume$coefficients
resume$coefficients[K]
resume$coefficients["K"]
resume$coefficients[4]
resume$coefficients
resume$coefficients[4,]
resume$coefficients[4,4]
resume$coefficients[5,4]
resume$coefficients[5,4] < 0.05
resume
resume$coefficients[,4]
resume$coefficients[,4][resume$coefficients[,4] < 0.05]
cor(pommes[])
cor(pommes)
cor(pommes[,2:7])
cor(pommes[,2:7])[>0.8]
cor(pommes[,2:7])[cor(pommes[,2:7])>0.8]
reg2=step(reg, direction="backward")
mod2=step(reg, direction="backward")
rm(reg2)
mod2=step(reg, direction="backward")
View(mod2)
mod2
# Question 1 : Lecture du fichier
fish <- read.csv2("Poissons.csv")
attach(fish)
# Question 2 : Transformation d'une variable en facteur
fish$Species=as.factor(fish$Species)
# Question 3 : Représentation du nuage de points du poids en fonction de la longueur
# on veut expliquer le poids grâce à la longueure du poisson
# variable à expliquer : Weight (y)
# variable explicative : Length (x)
plot(Length, Weight, col=c(2,3,4,5,6,7,8)[Species])
# Question 4a : Régression linéaire simple du poids sur la longueur
#reg(y~x, data)
reg=lm(Weight~Length, data=fish)
resume=summary(reg)
resume
# La taille du posson à une influence sur son poid : Proba critique < 0.05
# Question 4b : Droite de régression
lines(Length, predict(reg),col="red",lwd=3)
# Question 4c : Prédiction du poids d'un poisson de longueur 13 cm et de longueur 47 cm
predict(reg, data.frame(Length=13)) # impossible -> il faut revoir le modèle
predict(reg, data.frame(Length=47)) # prédiction plausible
# Question 4d : Graphe des résidus du premier modèle
plot(reg$fitted.values,reg$residuals, ylim = c(-500,500), xlab="residus",ylab="valeur ajusté")
abline(h=0, col="blue")
abline(h=-2*resume$sigma, col="red")
abline(h=2*resume$sigma, col="red")
# Les hypothèses ne sont pas vérifiées, les valeurs ne sont répartis de manière homogène autour de l'axe x=0 et il n'y a pas homoscédasticité des valeurs
# structure parabolique ?
# Question 5a : Régression linéaire simple du logarithme du poids sur la longueur
fish2 <- fish
fish2$Weight <- log(fish2$Weight)
reg2=lm(fish2$Weight~fish2$Length, data=fish2)
resume2=summary(reg2)
resume2
# Question 5b : Estimation de l'écart-type résiduel
x <- Length
y <- predict(reg2) #valeurs ajustées
e <- fish2$Weight - y # residu
sigma <- sqrt(sum(e^2)/(length(e)-2))
# On retrouve bien la même qu'avec summary
# Question 5c : Courbe d'ajustement du second modèle
plot(Length, Weight)
lines(Length, predict(reg),col="red",lwd=3)
lines(Length, exp(predict(reg2)), col="blue",lwd=3)
#le modèle sous estime le poid des vrèmes communes
# Question 5d : Graphes des résidus du second modèle
plot(reg2$fitted.values,reg2$residuals, ylim = c(-2,2), xlab="residus",ylab="valeur ajusté")
abline(h=0, col="blue")
abline(h=-2*resume2$sigma, col="red")
abline(h=2*resume2$sigma, col="red")
# Les hypothèses ne sont pas vérifiées, les valeurs ne sont répartis de manière homogène autour de l'axe x=0 et il n'y a pas homoscédasticité des valeurs
# strucuture parabolique
# Question 6a : Nuage de points du logarithme du poids en fonction de la longueur
plot(fish2$Length, fish2$Weight)
lines(Length, predict(reg2), col="blue",lwd=3)
# Question 6b : Proposition et ajustement d'un troisième modèle
# On observe une courbe parabolique sur le graphe des residus de la question 6a, il faut donc ajouter une variaves explicative au modèle
# On ajoute la variable explicative Length²
fish3 <- cbind.data.frame(fish2,Length2=fish2[,"Length"]^2)
reg3=lm(fish3$Weight~Length2, data=fish3)
resume3=summary(reg3)
resume3
plot(fish3$Length2, fish3$Weight)
lines(fish3$Length2, predict(reg3),col="green",lwd=3)
# Question 6c : Tracé de la courbe d'ajustement du troisième modèle
plot(Length, Weight, col=c(2,3,4,5,6,7,8)[fish$Species])
lines(Length, predict(reg),col="red",lwd=3)
lines(Length, exp(predict(reg2)), col="blue",lwd=3)
lines(Length, exp(predict(reg3)), col="green", lwd=3)
# pb avec les exponnentielles
# Question 7 : Ajustement d'un modèle exponentiel
reg4=lm(log(Weight)~log(Length)+log(Height)+log(Width),data=fish)
resume4=summary(reg4)
resume4
#a0 = -9.14250, a1 = 3.01707, a2 = 0.44477, a3 = 1.11300
# Question 8a: Détermination du R^2 de l'AIC des modèles
R2 <- c(resume2$r.squared, resume3$r.squared, resume4$r.squared)
# R² le plus proche de 1
# meilleur modèle : modèle 4
C <- c(extractAIC(reg2), extractAIC(reg3), extractAIC(reg4))
# AIC le plus faible
# meilleur modèle : modèle 4
# Question 8b : Prédiction du poids d'un poisson
predict(reg4, data.frame(Length=c(13,47),Height=c(13*0.17,47*0.17),Width=c(0.1*13,0.1*47)),interval="prediction")
fish[which(Species==1)]
fish[which(Species==1),]
plot(Length, Weight)
lines(Length, predict(reg),col="red",lwd=3)
lines(Length, exp(predict(reg2)), col="blue",lwd=3)
plot(fishS1$Length, fishS1$Weight)
fishS1 <- fish[which(Species==1),]
plot(fishS1$Length, fishS1$Weight)
lines(Length, exp(predict(reg2)), col="blue",lwd=3)
mod1=lm(Trait~Amert, data=pommes)
# Question 1 : Lecture du fichier
pommes <- read.table("pommes.txt", header = T)
attach(pommes)
# Question 2 : Analyse descriptive par traitement
# Question 3a : Régression linéaire multiple
reg=lm(Amert~TN+PN+P+K+Ca+Mg, data=pommes)
resume=summary(reg)
resume
# Question 3b : Intervalle de confiance sur un paramètre
resume$coefficients[5,4] < 0.05
# True donc B4 est significativement != 0
# Question 3c
resume$coefficients[,4][resume$coefficients[,4] < 0.05]
#K et Ca ont une influence sur l'amertume
# Question 3d : Corrélation entre les variables explicatives
cor(pommes[,2:7])
#TN et PN, TN et P, PN et P
# Question 3e : Sélection de variables
mod2=step(reg, direction="backward")
mod2
mod1=lm(Trait~Amert, data=pommes)
mod1=lm(Amert~Trait, data=pommes)
plot(mod1)
par(mfrow=c(2,2))
plot(mod1)
par(mfrow=c(1,1))
anova(mod1)
summary(mod1)
setwd("~/Info_3a/TP_R/TP_S6/TP4/TP4_Donnees")
tab<-read.table("hotdogs.txt", header=TRUE)
attach(tab)
tab=tab[-which(tab$Type==4),]
# on a enlevé du df les lignes pour lesquels Type = 4 ( 1 ligne )
tab$Type=as.factor(tab$Type)
# type : int -> type : factor ("1", "2", "3", "4")
#Q2
summary(Calories)
summary(Sodium)
by(tab, tab$Type, summary)
boxplot(Calories~Type)
boxplot(Sodium~Type)
# boeuf et melange de boeuf assez haut en calorie, volail moins riche en calories
# le boeuf est globalement moins riche en sel mais peut atteindre ponctuellement des taux de sodium plus élévé
#Q3
# modele assoccié à l'experience :
# Pour tous i=1,2,3 et pour tout j = 1,...,n  Calories_ij = mu + a_i + e_ij avec e_ij iid ~ N(0,s²)
#Calories_ij ~ N(mu + ai, s²)
mod1=lm(Calories~Type, data=tab)
#mod = lm(Calories~Type, data=Tab, contrast=list(Type="contr.sum"))
#Pour forcer la contrainte naturelle au lieu de la contrainte par défaut de R
par(mfrow=c(2,2))
plot(mod1)
par(mfrow=c(1,1))
# Répartie de manière homogène autour et 0 et homoscédastique
# aligné sur les valeurs ajusté des factors
# Q-Q plot -> modèle de la loi observé s'éloigne du modèle d'une loi normale
anova(mod1)
# Df : degré de liberté, Sum Sq : sommes des carré ( SCM et SCR), Mean Sq : carré moyen ( CCM et CCR), F value = F0 = CCM / CCR, Pr : Proba critique
# H0 : Type n'a pas d'influence sur le modèle : a1 = a2 = a3 = 0
# H1 : Type à une influence sur le modèle : il existe i tq ai != 0
# la proba critique est < 0.05 => on rejette H0, donc type à une influence sur le modèle => au moins un ai != 0
summary(mod1)
# mû : 156.850 ( nb de calories moyen pour tous les sandwichs de type 1)
# contrainte utilisé : Contrainte témoin â1 = 0
# â2 : 1.856 ( nb de claories en plus d'un sandwich de type 2 /r à type 1)
# â3 : -38.085 ( nb de claories en moins en moyenne d'un sandwich de type 3 /r à type 1)
# nb calories prédit
# Type1 = 156.85
# Type2 = 2012.85
# Type3 = 118.765
# R² = 0.3866
#s⁵ = 23.46
summary(mod1)
setwd("~/Info_3a/TP_R/TP_S6/TP_2021")
# Question 1 : Lecture du fichier
pommes <- read.table("pommes.txt", header = T)
attach(pommes)
# Question 2 : Analyse descriptive par traitement
# Question 3a : Régression linéaire multiple
reg=lm(Amert~TN+PN+P+K+Ca+Mg, data=pommes)
resume=summary(reg)
resume
# Question 3b : Intervalle de confiance sur un paramètre
resume$coefficients[5,4] < 0.05
# True donc B4 est significativement != 0
# Question 3c
resume$coefficients[,4][resume$coefficients[,4] < 0.05]
#K et Ca ont une influence sur l'amertume
# Question 3d : Corrélation entre les variables explicatives
cor(pommes[,2:7])
#TN et PN, TN et P, PN et P
# Question 3e : Sélection de variables
mod2=step(reg, direction="backward")
mod2
# Question 3f
# Question 4a : ANOVA sur l'amertume des pommes
mod1=lm(Amert~Trait, data=pommes)
par(mfrow=c(2,2))
plot(mod1)
par(mfrow=c(1,1))
anova(mod1)
summary(mod1)
library(emmeans)
emmeans(mod1, pairwise~Type, adjust="bonferroni")
emmeans(mod1, pairwise~Trait, adjust="bonferroni")
mod2=lm(Poids~Trait, data=pommes)
anova(mod2)
summary(mod2)
emmeans(mod2, pairwise~Trait, adjust="bonferroni")
summary(mod2)
anova(mod1)
anova(mod1)$coefficient
anova(mod1)$Response
mod1
mod1$coefficients
anova(mod1)
anova(mod2)
# proba critique < 0.05 donc le traitement à un effet sur le poid des pommes au risque de 5%
summary(mod2)
summary(mod2)$coefficient
summary(mod2)$coefficient[2,4]
summary(mod2)$coefficient[2,4] < 0.05
emmeans(mod2, pairwise~Trait, adjust="bonferroni")
